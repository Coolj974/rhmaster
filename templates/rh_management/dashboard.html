{% extends "base.html" %}

{% block extra_css %}
<style>
    /* Styles améliorés pour le dashboard */
    .dashboard-container {
        padding: 1.2rem 0;
    }
    
    .welcome-section {
        background: linear-gradient(135deg, #f8f9fa, #eaecf4);
        border-radius: 12px;
        padding: 1.5rem;
        margin-bottom: 1.5rem;
        box-shadow: 0 2px 5px rgba(0,0,0,0.05);
        border-left: 4px solid #4e73df;
        transition: all 0.3s ease;
    }
    
    .welcome-section:hover {
        transform: translateY(-3px);
        box-shadow: 0 5px 15px rgba(0,0,0,0.1);
    }
    
    .action-card {
        height: 100%;
        border: none;
        border-radius: 10px;
        overflow: hidden;
        transition: all 0.3s ease;
        box-shadow: 0 4px 6px rgba(0,0,0,0.05);
    }
    
    .action-card:hover {
        transform: translateY(-5px);
        box-shadow: 0 10px 20px rgba(0,0,0,0.1);
    }
    
    .action-card .card-body {
        padding: 1.5rem;
        display: flex;
        flex-direction: column;
    }
    
    .action-card .icon-container {
        width: 50px;
        height: 50px;
        border-radius: 10px;
        display: flex;
        align-items: center;
        justify-content: center;
        margin-bottom: 1rem;
        font-size: 1.5rem;
    }
    
    .action-card .card-title {
        font-size: 1.1rem;
        font-weight: 600;
        margin-bottom: 0.75rem;
    }
    
    .action-card .card-text {
        color: #6c757d;
        flex-grow: 1;
        margin-bottom: 1.25rem;
    }
    
    .action-card .btn {
        font-size: 0.9rem;
        padding: 0.5rem 1rem;
        border-radius: 8px;
        font-weight: 500;
        transition: all 0.2s;
    }
    
    .action-card .btn:hover {
        transform: translateY(-2px);
    }
    
    .stats-card {
        border-radius: 10px;
        transition: all 0.3s;
        height: 100%;
    }
    
    .stats-card:hover {
        transform: translateY(-3px);
    }
    
    .stat-item {
        padding: 1rem;
        border-radius: 8px;
        margin-bottom: 1rem;
        background: #fff;
        box-shadow: 0 2px 4px rgba(0,0,0,0.04);
        display: flex;
        align-items: center;
        transition: all 0.2s;
    }
    
    .stat-item:hover {
        background-color: #f8f9fc;
        transform: translateX(3px);
    }
    
    .stat-icon {
        width: 45px;
        height: 45px;
        border-radius: 10px;
        display: flex;
        align-items: center;
        justify-content: center;
        font-size: 1.2rem;
        margin-right: 1rem;
    }
    
    .stat-text {
        flex-grow: 1;
    }
    
    .stat-title {
        font-size: 0.85rem;
        color: #6c757d;
        margin-bottom: 0.25rem;
    }
    
    .stat-value {
        font-size: 1.25rem;
        font-weight: 600;
        color: #3a3b45;
    }
    
    .action-link {
        text-decoration: none;
        color: inherit;
        display: block;
        height: 100%;
    }
    
    .action-link:hover {
        color: inherit;
    }
    
    /* Indicateurs d'activité avec pulsation */
    .activity-indicator {
        width: 10px;
        height: 10px;
        border-radius: 50%;
        display: inline-block;
        margin-right: 8px;
        position: relative;
    }
    
    .activity-indicator.active {
        background-color: #1cc88a;
    }
    
    .activity-indicator.active::before {
        content: '';
        position: absolute;
        top: -2px;
        left: -2px;
        right: -2px;
        bottom: -2px;
        border-radius: 50%;
        background-color: rgba(28, 200, 138, 0.5);
        animation: pulse 2s infinite;
    }
    
    @keyframes pulse {
        0% {
            transform: scale(1);
            opacity: 0.8;
        }
        70% {
            transform: scale(1.7);
            opacity: 0;
        }
        100% {
            transform: scale(1.7);
            opacity: 0;
        }
    }
    
    /* Améliorations pour les devices mobiles */
    @media (max-width: 767.98px) {
        .welcome-section {
            padding: 1.2rem;
        }
        
        .action-card .card-body {
            padding: 1.2rem;
        }
    }
    
    /* Messages d'alerte plus visibles */
    .alert {
        border-radius: 10px;
        border-left: 4px solid;
    }
    
    .alert-success {
        border-color: #1cc88a;
    }
    
    .alert-warning {
        border-color: #f6c23e;
    }
    
    .alert-danger {
        border-color: #e74a3b;
    }
    
    /* Timeline améliorée */
    .timeline {
        position: relative;
        padding-left: 1.5rem;
        margin: 0 0 0 30px;
        color: #6c757d;
    }
    
    .timeline:before {
        content: ' ';
        background: #e3e6f0;
        display: inline-block;
        position: absolute;
        left: 0;
        width: 2px;
        height: 100%;
        z-index: 1;
    }
    
    .timeline-item {
        margin: 1.5rem 0;
        position: relative;
    }
    
    .timeline-item:first-child {
        margin-top: 0;
    }
    
    .timeline-item:before {
        content: ' ';
        background: white;
        display: inline-block;
        position: absolute;
        border-radius: 50%;
        left: -38px;
        width: 16px;
        height: 16px;
        z-index: 2;
        border: 2px solid #4e73df;
    }
    
    /* Nouveaux styles pour les cartes d'actions */
    .quick-action-card {
        border: none;
        border-radius: 12px;
        overflow: hidden;
        transition: all 0.3s ease;
        margin-bottom: 20px;
        box-shadow: 0 4px 6px rgba(0,0,0,0.04);
    }
    
    .quick-action-card:hover {
        transform: translateY(-5px);
        box-shadow: 0 8px 15px rgba(0,0,0,0.08);
    }
    
    /* Section des statistiques visuelles */
    .stats-visual {
        background: #fff;
        border-radius: 12px;
        padding: 1.5rem;
        box-shadow: 0 2px 5px rgba(0,0,0,0.05);
        margin-bottom: 1.5rem;
    }
    
    .progress-bar-container {
        height: 8px;
        background-color: #e9ecef;
        border-radius: 4px;
        margin-bottom: 0.5rem;
    }
    
    .progress-bar-fill {
        height: 100%;
        border-radius: 4px;
    }
    
    /* Tableau des congés amélioré */
    .leave-table {
        border-collapse: separate;
        border-spacing: 0;
    }
    
    .leave-table th {
        background-color: #f8f9fc;
        font-weight: 600;
        padding: 12px 15px;
    }
    
    .leave-table td {
        padding: 12px 15px;
        vertical-align: middle;
    }
    
    .leave-table tbody tr {
        transition: all 0.2s;
    }
    
    .leave-table tbody tr:hover {
        background-color: rgba(78, 115, 223, 0.05);
    }
    
    /* Badge avec animation */
    .badge-animated {
        position: relative;
        overflow: hidden;
    }
    
    .badge-animated:after {
        content: '';
        position: absolute;
        top: -50%;
        left: -50%;
        width: 200%;
        height: 200%;
        background: linear-gradient(60deg, transparent, rgba(255,255,255,0.3), transparent);
        transform: rotate(30deg);
        animation: shimmer 2s infinite;
    }
    
    @keyframes shimmer {
        0% {
            transform: translateX(-100%) rotate(30deg);
        }
        100% {
            transform: translateX(100%) rotate(30deg);
        }
    }
</style>
{% endblock %}

{% block content %}
<div class="container dashboard-container">
    <!-- Message de bienvenue personnalisé -->
    <div class="welcome-section mb-4">
        <div class="row align-items-center">
            <div class="col-auto">
                <div class="avatar-wrapper">
                    {% if request.user.userprofile.profile_picture %}
                        <img src="{{ request.user.userprofile.profile_picture.url }}" alt="Photo de profil" 
                             class="rounded-circle shadow-sm" style="width: 60px; height: 60px; object-fit: cover;">
                    {% else %}
                        <div class="rounded-circle bg-primary text-white d-flex align-items-center justify-content-center shadow-sm" 
                             style="width: 60px; height: 60px; font-size: 1.5rem;">
                            {{ request.user.username.0|upper }}
                        </div>
                    {% endif %}
                </div>
            </div>
            <div class="col">
                <h2 class="h4 mb-1">Bienvenue, {{ request.user.get_full_name|default:request.user.username }}</h2>
                <p class="text-muted mb-0">
                    <span class="activity-indicator active"></span>
                    Connecté en tant que 
                    {% if request.user.is_superuser %}
                        <span class="badge bg-danger">Administrateur</span>
                    {% elif is_rh %}
                        <span class="badge bg-warning text-dark">RH</span>
                    {% elif is_encadrant %}
                        <span class="badge bg-info">Encadrant</span>
                    {% elif is_stp %}
                        <span class="badge bg-success">STP</span>
                    {% else %}
                        <span class="badge bg-primary">Employé</span>
                    {% endif %}
                </p>
            </div>
            <div class="col-auto">
                <div class="current-date text-end">
                    <div class="h5 mb-0">{{ current_date|date:"l j F Y" }}</div>
                    <div class="small text-muted" id="current-time">{{ current_date|time:"H:i:s" }}</div>
                </div>
            </div>
        </div>
    </div>

    {% if messages %}
    <div class="mb-4">
        {% for message in messages %}
            <div class="alert alert-{{ message.tags }} alert-dismissible fade show shadow-sm" role="alert">
                <i class="fas {% if message.tags == 'success' %}fa-check-circle{% elif message.tags == 'danger' %}fa-exclamation-circle{% else %}fa-info-circle{% endif %} me-2"></i>
                {{ message }}
                <button type="button" class="btn-close" data-bs-dismiss="alert" aria-label="Close"></button>
            </div>
        {% endfor %}
    </div>
    {% endif %}

    <!-- Actions principales pour tous les utilisateurs -->
    <div class="row mb-4">
        <div class="col-lg-3 col-md-6 mb-4">
            <a href="{% url 'leave_request' %}" class="action-link">
                <div class="card action-card">
                    <div class="card-body">
                        <div class="icon-container bg-primary bg-opacity-10 text-primary">
                            <i class="fas fa-calendar-plus"></i>
                        </div>
                        <h5 class="card-title">Demande de congé</h5>
                        <p class="card-text">Soumettez une nouvelle demande de congé ou consultez vos demandes existantes.</p>
                        <div class="d-grid">
                            <button class="btn btn-primary">
                                <i class="fas fa-plus-circle me-1"></i> Nouvelle demande
                            </button>
                        </div>
                    </div>
                </div>
            </a>
        </div>
        
        <div class="col-lg-3 col-md-6 mb-4">
            <a href="{% url 'my_leaves' %}" class="action-link">
                <div class="card action-card">
                    <div class="card-body">
                        <div class="icon-container bg-success bg-opacity-10 text-success">
                            <i class="fas fa-calendar-check"></i>
                        </div>
                        <h5 class="card-title">Mes congés</h5>
                        <p class="card-text">Consultez l'historique de vos congés et le solde de jours disponibles.</p>
                        <div class="d-grid">
                            <button class="btn btn-success">
                                <i class="fas fa-list-ul me-1"></i> Voir mes congés
                            </button>
                        </div>
                    </div>
                </div>
            </a>
        </div>
        
        <div class="col-lg-3 col-md-6 mb-4">
            <a href="{% url 'submit_expense' %}" class="action-link">
                <div class="card action-card">
                    <div class="card-body">
                        <div class="icon-container bg-warning bg-opacity-10 text-warning">
                            <i class="fas fa-file-invoice-dollar"></i>
                        </div>
                        <h5 class="card-title">Note de frais</h5>
                        <p class="card-text">Soumettez une nouvelle note de frais pour vos dépenses professionnelles.</p>
                        <div class="d-grid">
                            <button class="btn btn-warning text-dark">
                                <i class="fas fa-receipt me-1"></i> Nouvelle note
                            </button>
                        </div>
                    </div>
                </div>
            </a>
        </div>
        
        <div class="col-lg-3 col-md-6 mb-4">
            <a href="{% url 'my_expenses' %}" class="action-link">
                <div class="card action-card">
                    <div class="card-body">
                        <div class="icon-container bg-info bg-opacity-10 text-info">
                            <i class="fas fa-search-dollar"></i>
                        </div>
                        <h5 class="card-title">Mes notes de frais</h5>
                        <p class="card-text">Consultez vos notes de frais existantes et leur statut actuel.</p>
                        <div class="d-grid">
                            <button class="btn btn-info">
                                <i class="fas fa-list-ul me-1"></i> Voir mes notes
                            </button>
                        </div>
                    </div>
                </div>
            </a>
        </div>
    </div>

    <!-- Résumé visuel des statistiques -->
    <div class="row mb-4">
        <div class="col-12">
            <div class="stats-visual rounded-4 shadow-sm border-0 position-relative">
                <div class="row p-3">
                    <!-- Synthèse des congés -->
                    <div class="col-md-6 mb-3 mb-md-0">
                        <div class="d-flex align-items-center mb-3">
                            <div class="icon-bubble bg-primary-subtle text-primary me-3">
                                <i class="fas fa-calendar-alt"></i>
                            </div>
                            <h5 class="mb-0 fw-bold">Synthèse des congés</h5>
                        </div>
                        
                        <div class="stat-card mb-4">
                            <div class="card-body p-3">
                                <div class="d-flex justify-content-between align-items-center mb-2">
                                    <span class="fw-medium">Solde disponible</span>
                                    <span class="badge-modern {% if leave_balance.available < 5 %}warning{% elif leave_balance.available < 2 %}danger{% else %}success{% endif %}">
                                        {{ leave_balance.available|default:"0" }} / {{ leave_balance.acquired|default:"0" }} jours
                                    </span>
                                </div>
                                <div class="progress-container">
                                    <div class="progress-bar 
                                        {% if leave_balance.available_percentage < 20 %}bg-danger
                                        {% elif leave_balance.available_percentage < 50 %}bg-warning
                                        {% else %}bg-primary{% endif %}" 
                                        style="width: {{ leave_balance.available_percentage|default:"0" }}%">
                                    </div>
                                </div>
                                <div class="d-flex justify-content-between mt-2">
                                    <span class="small">Utilisés: {{ leave_balance.taken|default:"0" }}</span>
                                    <span class="small fw-semibold {% if leave_balance.available_percentage < 30 %}text-danger{% elif leave_balance.available_percentage < 60 %}text-warning{% else %}text-success{% endif %}">
                                        {{ leave_balance.available_percentage|default:"0" }}% restant
                                    </span>
                                </div>
                            </div>
                        </div>
                        
                        <div class="row g-3">
                            <div class="col-4">
                                <div class="stat-counter success">
                                    <div class="counter-icon">
                                        <i class="fas fa-check"></i>
                                    </div>
                                    <div class="counter-value">{{ stats.approved_count|default:"0" }}</div>
                                    <div class="counter-label">Approuvés</div>
                                </div>
                            </div>
                            <div class="col-4">
                                <div class="stat-counter warning">
                                    <div class="counter-icon">
                                        <i class="fas fa-clock"></i>
                                    </div>
                                    <div class="counter-value">{{ stats.pending_count|default:"0" }}</div>
                                    <div class="counter-label">En attente</div>
                                </div>
                            </div>
                            <div class="col-4">
                                <div class="stat-counter danger">
                                    <div class="counter-icon">
                                        <i class="fas fa-times"></i>
                                    </div>
                                    <div class="counter-value">{{ stats.rejected_count|default:"0" }}</div>
                                    <div class="counter-label">Refusés</div>
                                </div>
                            </div>
                        </div>
                    </div>
                    
                    <!-- Notes de frais -->
                    <div class="col-md-6">
                        <div class="d-flex align-items-center mb-3">
                            <div class="icon-bubble bg-success-subtle text-success me-3">
                                <i class="fas fa-money-bill-wave"></i>
                            </div>
                            <h5 class="mb-0 fw-bold">Notes de frais</h5>
                        </div>
                        
                        <div class="stat-card mb-4">
                            <div class="card-body p-3">
                                <div class="row">
                                    <div class="col-6 border-end">
                                        <div class="text-center p-2">
                                            <div class="small mb-1">Total soumis</div>
                                            <div class="h3 mb-0 fw-bold">{{ expenses_stats.total|default:"0" }}</div>
                                        </div>
                                    </div>
                                    <div class="col-6">
                                        <div class="text-center p-2">
                                            <div class="small mb-1">Remboursés</div>
                                            <div class="h3 mb-0 fw-bold text-success">
                                                <i class="fas fa-euro-sign fa-sm"></i> {{ expenses_stats.reimbursed|default:"0" }}
                                            </div>
                                        </div>
                                    </div>
                                </div>
                            </div>
                        </div>
                        
                        <div class="row mt-4">
                            <div class="col-4">
                                <div class="stat-counter success">
                                    <div class="counter-icon">
                                        <i class="fas fa-check-circle"></i>
                                    </div>
                                    <div class="counter-value">{{ expenses_stats.approved|default:"0" }}</div>
                                    <div class="counter-label">Approuvés</div>
                                </div>
                            </div>
                            <div class="col-4">
                                <div class="stat-counter warning">
                                    <div class="counter-icon">
                                        <i class="fas fa-hourglass-half"></i>
                                    </div>
                                    <div class="counter-value">{{ expenses_stats.pending|default:"0" }}</div>
                                    <div class="counter-label">En attente</div>
                                </div>
                            </div>
                            <div class="col-4">
                                <div class="stat-counter danger">
                                    <div class="counter-icon">
                                        <i class="fas fa-ban"></i>
                                    </div>
                                    <div class="counter-value">{{ expenses_stats.rejected|default:"0" }}</div>
                                    <div class="counter-label">Refusés</div>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <!-- Additional CSS for modern components -->
    <style>
        /* Modern styling for stat cards */
        .stat-card {
            border-radius: 12px;
            border: none;
            background-color: #fff;
            box-shadow: 0 4px 15px rgba(0, 0, 0, 0.05);
            transition: all 0.3s ease;
        }
        
        .stat-card:hover {
            transform: translateY(-3px);
            box-shadow: 0 8px 25px rgba(0, 0, 0, 0.1);
        }
        
        /* Icon bubble */
        .icon-bubble {
            width: 48px;
            height: 48px;
            border-radius: 12px;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 1.2rem;
            transition: all 0.3s ease;
        }
        
        /* Modern progress bar */
        .progress-container {
            height: 10px;
            background-color: #e9ecef;
            border-radius: 10px;
            overflow: hidden;
            margin-bottom: 0.5rem;
        }
        
        .progress-bar {
            height: 100%;
            border-radius: 10px;
            transition: width 1s ease-in-out;
        }
        
        /* Modern badges */
        .badge-modern {
            padding: 0.5rem 1rem;
            border-radius: 20px;
            font-weight: 600;
            font-size: 0.8rem;
            box-shadow: 0 2px 5px rgba(0, 0, 0, 0.1);
        }
        
        .badge-modern.success {
            background-color: #e6f7f0;
            color: #0cb876;
        }
        
        .badge-modern.warning {
            background-color: #fff8e6;
            color: #f5a623;
        }
        
        .badge-modern.danger {
            background-color: #feeceb;
            color: #f64e60;
        }
        
        /* Modern counters */
        .stat-counter {
            padding: 1rem;
            border-radius: 12px;
            text-align: center;
            transition: all 0.3s ease;
            background-color: #fff;
            box-shadow: 0 4px 10px rgba(0, 0, 0, 0.03);
            height: 100%;
        }
        
        .stat-counter:hover {
            transform: translateY(-5px);
            box-shadow: 0 10px 20px rgba(0, 0, 0, 0.08);
        }
        
        .counter-icon {
            width: 45px;
            height: 45px;
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            margin: 0 auto 10px;
            font-size: 1.2rem;
        }
        
        .stat-counter.success .counter-icon {
            background-color: #e6f7f0;
            color: #0cb876;
        }
        
        .stat-counter.warning .counter-icon {
            background-color: #fff8e6;
            color: #f5a623;
        }
        
        .stat-counter.danger .counter-icon {
            background-color: #feeceb;
            color: #f64e60;
        }
        
        .counter-value {
            font-size: 1.8rem;
            font-weight: bold;
            margin-bottom: 5px;
            color: #333;
        }
        
        .counter-label {
            font-size: 0.8rem;
            color: #6c757d;
        }
        
        /* Stats visual container */
        .stats-visual {
            background-color: #fff;
            transition: all 0.3s ease;
            padding: 1.5rem;
        }
    </style>

    <!-- JavaScript for counter animation -->
    <script>
        document.addEventListener('DOMContentLoaded', function() {
            // Animate counters
            const counterElements = document.querySelectorAll('.counter-value');
            counterElements.forEach(counter => {
                const target = parseInt(counter.textContent, 10);
                let count = 0;
                const increment = target / 20;
                
                const updateCount = () => {
                    if (count < target) {
                        count += increment;
                        counter.textContent = Math.ceil(count);
                        setTimeout(updateCount, 50);
                    } else {
                        counter.textContent = target;
                    }
                };
                
                updateCount();
            });
        });
    </script>

    <!-- Section pour les demandes de congés en attente (pour les RH et admins) -->
    {% if is_hr or is_admin %}
    <div class="row mb-4">
        <div class="col-12">
            <div class="card shadow h-100 rounded-4">
                <div class="card-header py-3 d-flex justify-content-between align-items-center bg-white rounded-top">
                    <h6 class="m-0 font-weight-bold text-primary">
                        <i class="fas fa-clock fa-sm mr-2"></i> Demandes en attente
                    </h6>
                    <a href="{% url 'manage_leaves' %}" class="btn btn-sm btn-outline-primary">Voir tout</a>
                </div>
                <div class="card-body">
                    <!-- Onglets -->
                    <ul class="nav nav-tabs mb-3" id="pendingTabs" role="tablist">
                        <li class="nav-item" role="presentation">
                            <button class="nav-link active" id="leaves-tab" data-bs-toggle="tab" data-bs-target="#leaves" type="button" role="tab">
                                Congés 
                                {% if pending_leaves_count > 0 %}
                                <span class="badge bg-danger ms-1 badge-animated">{{ pending_leaves_count }}</span>
                                {% endif %}
                            </button>
                        </li>
                        <li class="nav-item" role="presentation">
                            <button class="nav-link" id="expenses-tab" data-bs-toggle="tab" data-bs-target="#expenses" type="button" role="tab">
                                Frais 
                                {% if pending_expenses_count > 0 %}
                                <span class="badge bg-danger ms-1 badge-animated">{{ pending_expenses_count }}</span>
                                {% endif %}
                            </button>
                        </li>
                        <li class="nav-item" role="presentation">
                            <button class="nav-link" id="kilometrics-tab" data-bs-toggle="tab" data-bs-target="#kilometrics" type="button" role="tab">
                                Kilométrique 
                                {% if pending_kilometrics_count > 0 %}
                                <span class="badge bg-danger ms-1 badge-animated">{{ pending_kilometrics_count }}</span>
                                {% endif %}
                            </button>
                        </li>
                    </ul>
                    
                    <!-- Contenu des onglets -->
                    <div class="tab-content">
                        <!-- Onglet Congés -->
                        <div class="tab-pane fade show active" id="leaves" role="tabpanel">
                            {% if pending_leaves %}
                                <div class="table-responsive">
                                    <table class="table leave-table">
                                        <thead>
                                            <tr>
                                                <th>Employé</th>
                                                <th>Période</th>
                                                <th>Type</th>
                                                <th>Durée</th>
                                                <th>Actions</th>
                                            </tr>
                                        </thead>
                                        <tbody>
                                            {% for leave in pending_leaves|slice:":5" %}
                                                <tr>
                                                    <td>
                                                        <div class="d-flex align-items-center">
                                                            <div class="me-2">
                                                                {% if leave.user.userprofile.profile_picture %}
                                                                    <img src="{{ leave.user.userprofile.profile_picture.url }}" class="rounded-circle" width="32" height="32">
                                                                {% else %}
                                                                    <div class="rounded-circle bg-secondary text-white d-flex align-items-center justify-content-center" style="width: 32px; height: 32px; font-size: 0.8rem;">
                                                                        {{ leave.user.username.0|upper }}
                                                                    </div>
                                                                {% endif %}
                                                            </div>
                                                            <div>
                                                                {{ leave.user.get_full_name|default:leave.user.username }}
                                                            </div>
                                                        </div>
                                                    </td>
                                                    <td>
                                                        <span class="d-block">{{ leave.start_date|date:"d/m/Y" }}</span>
                                                        <small class="text-muted">au {{ leave.end_date|date:"d/m/Y" }}</small>
                                                    </td>
                                                    <td>
                                                        <span class="badge bg-light text-dark">{{ leave.get_leave_type_display }}</span>
                                                    </td>
                                                    <td>{{ leave.days_requested }} jour(s)</td>
                                                    <td>
                                                        <a href="{% url 'approve_leave' leave.id %}" class="btn btn-sm btn-success me-1">
                                                            <i class="fas fa-check"></i>
                                                        </a>
                                                        <a href="{% url 'reject_leave' leave.id %}" class="btn btn-sm btn-danger">
                                                            <i class="fas fa-times"></i>
                                                        </a>
                                                    </td>
                                                </tr>
                                            {% endfor %}
                                        </tbody>
                                    </table>
                                </div>
                                {% if pending_leaves.count > 5 %}
                                    <div class="text-center mt-3">
                                        <a href="{% url 'manage_leaves' %}" class="btn btn-outline-primary">Voir toutes les demandes</a>
                                    </div>
                                {% endif %}
                            {% else %}
                                <div class="text-center py-4">
                                    <i class="far fa-calendar-check fa-3x mb-3 text-muted"></i>
                                    <p class="mb-0">Aucune demande de congé en attente.</p>
                                </div>
                            {% endif %}
                        </div>
                        
                        <!-- Onglet Notes de frais -->
                        <div class="tab-pane fade" id="expenses" role="tabpanel">
                            {% if pending_expenses %}
                                <div class="table-responsive">
                                    <table class="table leave-table">
                                        <thead>
                                            <tr>
                                                <th>Employé</th>
                                                <th>Date</th>
                                                <th>Description</th>
                                                <th>Montant</th>
                                                <th>Actions</th>
                                            </tr>
                                        </thead>
                                        <tbody>
                                            {% for expense in pending_expenses|slice:":5" %}
                                                <tr>
                                                    <td>{{ expense.user.get_full_name|default:expense.user.username }}</td>
                                                    <td>{{ expense.date|date:"d/m/Y" }}</td>
                                                    <td>{{ expense.description|truncatechars:30 }}</td>
                                                    <td>{{ expense.amount }} €</td>
                                                    <td>
                                                        <a href="{% url 'approve_expense' expense.id %}" class="btn btn-sm btn-success me-1">
                                                            <i class="fas fa-check"></i>
                                                        </a>
                                                        <a href="{% url 'reject_expense' expense.id %}" class="btn btn-sm btn-danger">
                                                            <i class="fas fa-times"></i>
                                                        </a>
                                                    </td>
                                                </tr>
                                            {% endfor %}
                                        </tbody>
                                    </table>
                                </div>
                                {% if pending_expenses.count > 5 %}
                                    <div class="text-center mt-3">
                                        <a href="{% url 'manage_expenses' %}" class="btn btn-outline-primary">Voir toutes les notes</a>
                                    </div>
                                {% endif %}
                            {% else %}
                                <div class="text-center py-4">
                                    <i class="far fa-file-invoice-dollar fa-3x mb-3 text-muted"></i>
                                    <p class="mb-0">Aucune note de frais en attente.</p>
                                </div>
                            {% endif %}
                        </div>
                        
                        <!-- Onglet Frais kilométriques -->
                        <div class="tab-pane fade" id="kilometrics" role="tabpanel">
                            {% if pending_kilometrics %}
                                <div class="table-responsive">
                                    <table class="table leave-table">
                                        <thead>
                                            <tr>
                                                <th>Employé</th>
                                                <th>Date</th>
                                                <th>Trajet</th>
                                                <th>Distance</th>
                                                <th>Actions</th>
                                            </tr>
                                        </thead>
                                        <tbody>
                                            {% for km in pending_kilometrics|slice:":5" %}
                                                <tr>
                                                    <td>{{ km.user.get_full_name|default:km.user.username }}</td>
                                                    <td>{{ km.date|date:"d/m/Y" }}</td>
                                                    <td>{{ km.departure }} → {{ km.destination }}</td>
                                                    <td>{{ km.distance }} km</td>
                                                    <td>
                                                        <a href="{% url 'approve_kilometric_expense' km.id %}" class="btn btn-sm btn-success me-1">
                                                            <i class="fas fa-check"></i>
                                                        </a>
                                                        <a href="{% url 'reject_kilometric_expense' km.id %}" class="btn btn-sm btn-danger">
                                                            <i class="fas fa-times"></i>
                                                        </a>
                                                    </td>
                                                </tr>
                                            {% endfor %}
                                        </tbody>
                                    </table>
                                </div>
                                {% if pending_kilometrics.count > 5 %}
                                    <div class="text-center mt-3">
                                        <a href="{% url 'manage_kilometric_expenses' %}" class="btn btn-outline-primary">Voir tous les frais</a>
                                    </div>
                                {% endif %}
                            {% else %}
                                <div class="text-center py-4">
                                    <i class="far fa-car fa-3x mb-3 text-muted"></i>
                                    <p class="mb-0">Aucun frais kilométrique en attente.</p>
                                </div>
                            {% endif %}
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>
    {% endif %}

    <div class="row">
        <!-- Colonne des statistiques et notifications -->
        <div class="col-lg-4 mb-4">
            <div class="card stats-card mb-4">
                <div class="card-header py-3">
                    <h6 class="m-0 font-weight-bold text-primary">Mon résumé</h6>
                </div>
                <div class="card-body">
                    {% if leave_balance %}
                    <div class="stat-item">
                        <div class="stat-icon bg-primary bg-opacity-10 text-primary">
                            <i class="fas fa-calendar-day"></i>
                        </div>
                        <div class="stat-text">
                            <div class="stat-title">Solde de congés</div>
                            <div class="stat-value {% if leave_balance.available > 5 %}text-success{% elif leave_balance.available > 0 %}text-warning{% else %}text-danger{% endif %}">
                                {{ leave_balance.available }} jour(s)
                            </div>
                        </div>
                    </div>
                    {% endif %}
                    
                    <div class="stat-item">
                        <div class="stat-icon bg-success bg-opacity-10 text-success">
                            <i class="fas fa-check-circle"></i>
                        </div>
                        <div class="stat-text">
                            <div class="stat-title">Congés approuvés</div>
                            <div class="stat-value">{{ approved_leaves_count }}</div>
                        </div>
                    </div>
                    
                    <div class="stat-item">
                        <div class="stat-icon bg-warning bg-opacity-10 text-warning">
                            <i class="fas fa-clock"></i>
                        </div>
                        <div class="stat-text">
                            <div class="stat-title">Demandes en attente</div>
                            <div class="stat-value">{{ pending_leaves_count }}</div>
                        </div>
                    </div>
                    
                    <div class="stat-item">
                        <div class="stat-icon bg-info bg-opacity-10 text-info">
                            <i class="fas fa-receipt"></i>
                        </div>
                        <div class="stat-text">
                            <div class="stat-title">Notes de frais soumises</div>
                            <div class="stat-value">{{ expenses_count }}</div>
                        </div>
                    </div>
                </div>
            </div>
            
            <!-- Actions rapides (draggable) -->
            <div class="card mb-4 quick-actions-floating" id="quickActionsCard" style="position: fixed; bottom: 20px; right: 20px; z-index: 100; max-width: 320px;">
                <div class="card-header py-2 d-flex justify-content-between align-items-center">
                    <h6 class="m-0 font-weight-bold text-primary">Actions rapides</h6>
                    <div>
                        <button type="button" class="btn btn-sm btn-outline-secondary" id="minimizeQuickActions" title="Réduire">
                            <i class="fas fa-minus"></i>
                        </button>
                    </div>
                </div>
                <div class="card-body p-2" id="quickActionsBody">
                    <div class="row g-2">
                        <div class="col-6">
                            <a href="{% url 'leave_request' %}" class="btn btn-outline-primary w-100 py-2">
                                <i class="fas fa-plane-departure me-1"></i>
                                Congé
                            </a>
                        </div>
                        <div class="col-6">
                            <a href="{% url 'submit_expense' %}" class="btn btn-outline-warning w-100 py-2">
                                <i class="fas fa-receipt me-1"></i>
                                Frais
                            </a>
                        </div>
                        <div class="col-6 mt-2">
                            <a href="{% url 'submit_kilometric_expense' %}" class="btn btn-outline-info w-100 py-2">
                                <i class="fas fa-route me-1"></i>
                                Trajet
                            </a>
                        </div>
                        <div class="col-6 mt-2">
                            <a href="{% url 'profile' %}" class="btn btn-outline-secondary w-100 py-2">
                                <i class="fas fa-user-cog me-1"></i>
                                Profil
                            </a>
                        </div>
                    </div>
                </div>
                <div class="card-footer p-1 text-center" id="quickActionsMinimized" style="display: none;">
                    <button type="button" class="btn btn-sm btn-outline-primary" id="expandQuickActions">
                        <i class="fas fa-expand-alt me-1"></i> Actions
                    </button>
                </div>
            </div>

            <script>
                document.addEventListener('DOMContentLoaded', function() {
                    const quickActionsCard = document.getElementById('quickActionsCard');
                    const minimizeBtn = document.getElementById('minimizeQuickActions');
                    const expandBtn = document.getElementById('expandQuickActions');
                    const quickActionsBody = document.getElementById('quickActionsBody');
                    const quickActionsMinimized = document.getElementById('quickActionsMinimized');
                    const cardHeader = quickActionsCard.querySelector('.card-header');
                    
                    // Variables for dragging
                    let isDragging = false;
                    let startX, startY, initialLeft, initialTop;
                    
                    // Functions for responsiveness
                    function checkScreenSize() {
                        // On small screens, lock to bottom
                        if (window.innerWidth < 768) {
                            quickActionsCard.style.position = 'fixed';
                            quickActionsCard.style.left = 'auto';
                            quickActionsCard.style.right = '10px';
                            quickActionsCard.style.top = 'auto';
                            quickActionsCard.style.bottom = '10px';
                            quickActionsCard.style.maxWidth = '160px';
                            cardHeader.style.cursor = 'default'; // Remove drag cursor on mobile
                            
                            // Auto-minimize on small screens
                            if (window.innerWidth < 480) {
                                quickActionsBody.style.display = 'none';
                                quickActionsMinimized.style.display = 'block';
                            }
                        } else {
                            quickActionsCard.style.maxWidth = '320px';
                            cardHeader.style.cursor = 'move';
                            
                            // Restore saved position on larger screens
                            restorePosition();
                        }
                    }
                    
                    // Initialize position based on screen size
                    checkScreenSize();
                    
                    // Check screen size on resize
                    window.addEventListener('resize', checkScreenSize);
                    
                    // Handle mouse events for dragging (desktop)
                    cardHeader.addEventListener('mousedown', function(e) {
                        if (window.innerWidth >= 768 && !e.target.closest('button')) {
                            isDragging = true;
                            startX = e.clientX;
                            startY = e.clientY;
                            initialLeft = quickActionsCard.offsetLeft;
                            initialTop = quickActionsCard.offsetTop;
                            quickActionsCard.style.position = 'absolute';
                        }
                    });
                    
                    document.addEventListener('mousemove', function(e) {
                        if (isDragging) {
                            const newLeft = initialLeft + (e.clientX - startX);
                            const newTop = initialTop + (e.clientY - startY);
                            
                            // Keep within viewport bounds
                            const maxX = window.innerWidth - quickActionsCard.offsetWidth;
                            const maxY = window.innerHeight - quickActionsCard.offsetHeight;
                            
                            quickActionsCard.style.left = Math.min(Math.max(0, newLeft), maxX) + 'px';
                            quickActionsCard.style.top = Math.min(Math.max(0, newTop), maxY) + 'px';
                            quickActionsCard.style.right = 'auto';
                            quickActionsCard.style.bottom = 'auto';
                        }
                    });
                    
                    document.addEventListener('mouseup', function() {
                        if (isDragging) {
                            isDragging = false;
                            savePosition();
                        }
                    });
                    
                    // Handle touch events for dragging (mobile)
                    cardHeader.addEventListener('touchstart', function(e) {
                        if (window.innerWidth >= 768 && !e.target.closest('button')) {
                            const touch = e.touches[0];
                            isDragging = true;
                            startX = touch.clientX;
                            startY = touch.clientY;
                            initialLeft = quickActionsCard.offsetLeft;
                            initialTop = quickActionsCard.offsetTop;
                            quickActionsCard.style.position = 'absolute';
                            
                            // Prevent scrolling when dragging
                            e.preventDefault();
                        }
                    }, { passive: false });
                    
                    document.addEventListener('touchmove', function(e) {
                        if (isDragging) {
                            const touch = e.touches[0];
                            const newLeft = initialLeft + (touch.clientX - startX);
                            const newTop = initialTop + (touch.clientY - startY);
                            
                            // Keep within viewport bounds
                            const maxX = window.innerWidth - quickActionsCard.offsetWidth;
                            const maxY = window.innerHeight - quickActionsCard.offsetHeight;
                            
                            quickActionsCard.style.left = Math.min(Math.max(0, newLeft), maxX) + 'px';
                            quickActionsCard.style.top = Math.min(Math.max(0, newTop), maxY) + 'px';
                            quickActionsCard.style.right = 'auto';
                            quickActionsCard.style.bottom = 'auto';
                            
                            // Prevent scrolling when dragging
                            e.preventDefault();
                        }
                    }, { passive: false });
                    
                    document.addEventListener('touchend', function() {
                        if (isDragging) {
                            isDragging = false;
                            savePosition();
                        }
                    });
                    
                    // Minimize/Expand functionality
                    minimizeBtn.addEventListener('click', function() {
                        quickActionsBody.style.display = 'none';
                        quickActionsMinimized.style.display = 'block';
                        saveMinimizedState(true);
                    });
                    
                    expandBtn.addEventListener('click', function() {
                        quickActionsBody.style.display = 'block';
                        quickActionsMinimized.style.display = 'none';
                        saveMinimizedState(false);
                    });
                    
                    // Save position in localStorage
                    function savePosition() {
                        if (window.innerWidth >= 768) {
                            const position = {
                                left: quickActionsCard.style.left,
                                top: quickActionsCard.style.top
                            };
                            localStorage.setItem('quickActionsPosition', JSON.stringify(position));
                        }
                    }
                    
                    // Restore position from localStorage
                    function restorePosition() {
                        const savedPosition = localStorage.getItem('quickActionsPosition');
                        if (savedPosition && window.innerWidth >= 768) {
                            const position = JSON.parse(savedPosition);
                            quickActionsCard.style.position = 'absolute';
                            quickActionsCard.style.left = position.left || '20px';
                            quickActionsCard.style.top = position.top || '20px';
                            quickActionsCard.style.right = 'auto';
                            quickActionsCard.style.bottom = 'auto';
                        }
                    }
                    
                    // Save minimized state
                    function saveMinimizedState(isMinimized) {
                        localStorage.setItem('quickActionsMinimized', isMinimized);
                    }
                    
                    // Restore minimized state
                    function restoreMinimizedState() {
                        const isMinimized = localStorage.getItem('quickActionsMinimized') === 'true';
                        if (isMinimized && window.innerWidth >= 480) {
                            quickActionsBody.style.display = 'none';
                            quickActionsMinimized.style.display = 'block';
                        }
                    }
                    
                    // Restore minimized state on page load
                    restoreMinimizedState();
                });
            </script>
            
            <!-- Notifications récentes -->
            {% if notifications %}
            <div class="card stats-card">
                <div class="card-header py-3 d-flex justify-content-between align-items-center">
                    <h6 class="m-0 font-weight-bold text-primary">Notifications récentes</h6>
                    <a href="{% url 'notifications' %}" class="btn btn-sm btn-primary">Tout voir</a>
                </div>
                <div class="card-body">
                    <div class="timeline">
                        {% for notification in notifications %}
                        <div class="timeline-item">
                            <small class="text-muted">{{ notification.created_at|date:"d/m/Y H:i" }}</small>
                            <p class="mb-0 {% if not notification.read %}fw-bold{% endif %}">
                                <i class="fas {{ notification.icon }} text-{{ notification.color }} me-2"></i>
                                {{ notification.title }}
                            </p>
                        </div>
                        {% endfor %}
                    </div>
                </div>
            </div>
            {% endif %}
        </div>
        
        <!-- Colonne des actions administratives et approbations -->
        <div class="col-lg-8">
            <!-- Actions pour les administrateurs / RH / encadrants -->
            {% if is_admin or is_rh or is_encadrant %}
            <div class="card mb-4">
                <div class="card-header py-3">
                    <h6 class="m-0 font-weight-bold text-primary">Actions d'administration</h6>
                </div>
                <div class="card-body">
                    <div class="row">
                        {% if is_admin or is_rh or is_encadrant %}
                        <div class="col-md-6 mb-3">
                            <a href="{% url 'manage_leaves' %}" class="card action-link h-100">
                                <div class="card-body d-flex flex-column">
                                    <div class="d-flex align-items-center mb-3">
                                        <div class="rounded-circle bg-primary bg-opacity-10 p-3 me-3">
                                            <i class="fas fa-tasks text-primary"></i>
                                        </div>
                                        <div>
                                            <h6 class="mb-0">Gestion des congés</h6>
                                            <small class="text-muted">Approuver ou refuser des demandes</small>
                                        </div>
                                    </div>
                                    {% if pending_leave_requests_count > 0 %}
                                    <div class="badge bg-warning text-dark mt-auto">
                                        <i class="fas fa-bell me-1"></i> {{ pending_leave_requests_count }} demande(s) en attente
                                    </div>
                                    {% else %}
                                    <div class="badge bg-success mt-auto">
                                        <i class="fas fa-check me-1"></i> Aucune demande en attente
                                    </div>
                                    {% endif %}
                                </div>
                            </a>
                        </div>
                        
                        <div class="col-md-6 mb-3">
                            <a href="{% url 'manage_expenses' %}" class="card action-link h-100">
                                <div class="card-body d-flex flex-column">
                                    <div class="d-flex align-items-center mb-3">
                                        <div class="rounded-circle bg-warning bg-opacity-10 p-3 me-3">
                                            <i class="fas fa-file-invoice text-warning"></i>
                                        </div>
                                        <div>
                                            <h6 class="mb-0">Gestion des notes de frais</h6>
                                            <small class="text-muted">Valider ou refuser des notes</small>
                                        </div>
                                    </div>
                                    {% if pending_expense_reports_count > 0 %}
                                    <div class="badge bg-warning text-dark mt-auto">
                                        <i class="fas fa-bell me-1"></i> {{ pending_expense_reports_count }} note(s) en attente
                                    </div>
                                    {% else %}
                                    <div class="badge bg-success mt-auto">
                                        <i class="fas fa-check me-1"></i> Aucune note en attente
                                    </div>
                                    {% endif %}
                                </div>
                            </a>
                        </div>
                        {% endif %}
                        
                        {% if is_admin or is_rh %}
                        <div class="col-md-6 mb-3">
                            <a href="{% url 'manage_leave_balances' %}" class="card action-link h-100">
                                <div class="card-body d-flex flex-column">
                                    <div class="d-flex align-items-center mb-3">
                                        <div class="rounded-circle bg-success bg-opacity-10 p-3 me-3">
                                            <i class="fas fa-balance-scale text-success"></i>
                                        </div>
                                        <div>
                                            <h6 class="mb-0">Soldes de congés</h6>
                                            <small class="text-muted">Gérer les soldes des employés</small>
                                        </div>
                                    </div>
                                    <div class="badge bg-info mt-auto">
                                        <i class="fas fa-users me-1"></i> {{ leave_balance_count|default:"0" }} soldes à gérer
                                    </div>
                                </div>
                            </a>
                        </div>
                        
                        <div class="col-md-6 mb-3">
                            <a href="{% url 'manage_kilometric_expenses' %}" class="card action-link h-100">
                                <div class="card-body d-flex flex-column">
                                    <div class="d-flex align-items-center mb-3">
                                        <div class="rounded-circle bg-info bg-opacity-10 p-3 me-3">
                                            <i class="fas fa-route text-info"></i>
                                        </div>
                                        <div>
                                            <h6 class="mb-0">Frais kilométriques</h6>
                                            <small class="text-muted">Valider les trajets</small>
                                        </div>
                                    </div>
                                    {% if pending_km_expense_count > 0 %}
                                    <div class="badge bg-warning text-dark mt-auto">
                                        <i class="fas fa-bell me-1"></i> {{ pending_km_expense_count }} trajet(s) en attente
                                    </div>
                                    {% else %}
                                    <div class="badge bg-success mt-auto">
                                        <i class="fas fa-check me-1"></i> Aucun trajet en attente
                                    </div>
                                    {% endif %}
                                </div>
                            </a>
                        </div>
                        {% endif %}
                        
                        {% if is_admin %}
                        <div class="col-md-6 mb-3">
                            <a href="{% url 'manage_users' %}" class="card action-link h-100">
                                <div class="card-body d-flex flex-column">
                                    <div class="d-flex align-items-center mb-3">
                                        <div class="rounded-circle bg-danger bg-opacity-10 p-3 me-3">
                                            <i class="fas fa-users-cog text-danger"></i>
                                        </div>
                                        <div>
                                            <h6 class="mb-0">Gestion des utilisateurs</h6>
                                            <small class="text-muted">Créer, modifier ou désactiver des comptes</small>
                                        </div>
                                    </div>
                                    <div class="badge bg-info mt-auto">
                                        <i class="fas fa-users me-1"></i> {{ user_count|default:"0" }} utilisateurs
                                    </div>
                                </div>
                            </a>
                        </div>
                        
                        <div class="col-md-6 mb-3">
                            <a href="{% url 'manage_roles' %}" class="card action-link h-100">
                                <div class="card-body d-flex flex-column">
                                    <div class="d-flex align-items-center mb-3">
                                        <div class="rounded-circle bg-purple bg-opacity-10 p-3 me-3" style="background-color: rgba(128, 0, 128, 0.1);">
                                            <i class="fas fa-user-tag" style="color: purple;"></i>
                                        </div>
                                        <div>
                                            <h6 class="mb-0">Gestion des rôles</h6>
                                            <small class="text-muted">Gérer les rôles et permissions</small>
                                        </div>
                                    </div>
                                    <div class="badge bg-info mt-auto">
                                        <i class="fas fa-shield-alt me-1"></i> Configurer les accès
                                    </div>
                                </div>
                            </a>
                        </div>
                        {% endif %}
                    </div>
                    
                    {% if is_admin %}
                    <div class="text-end mt-2">
                        <a href="/admin/" class="btn btn-sm btn-outline-primary">
                            <i class="fas fa-cogs me-1"></i> Interface d'administration Django
                        </a>
                    </div>
                    {% endif %}
                </div>
            </div>
            {% endif %}
            
            <!-- Congés à venir -->
            <div class="card">
                <div class="card-header py-3 d-flex justify-content-between align-items-center">
                    <h6 class="m-0 font-weight-bold text-primary">Calendrier de mes congés</h6>
                    <a href="{% url 'my_leaves' %}" class="btn btn-sm btn-outline-primary">Voir tout</a>
                </div>
                <div class="card-body">
                    {% if upcoming_leaves %}
                    <div class="table-responsive">
                        <table class="table table-hover leave-table">
                            <thead>
                                <tr>
                                    <th>Date de début</th>
                                    <th>Date de fin</th>
                                    <th>Type</th>
                                    <th>Durée</th>
                                    <th>Statut</th>
                                </tr>
                            </thead>
                            <tbody>
                                {% for leave in upcoming_leaves %}
                                <tr>
                                    <td>{{ leave.start_date|date:"d/m/Y" }}</td>
                                    <td>{{ leave.end_date|date:"d/m/Y" }}</td>
                                    <td>{{ leave.get_leave_type_display }}</td>
                                    <td>{{ leave.days_requested }} jour(s)</td>
                                    <td>
                                        <span class="badge {% if leave.status == 'pending' %}bg-warning
                                            {% elif leave.status == 'approved' %}bg-success
                                            {% elif leave.status == 'rejected' %}bg-danger{% endif %}">
                                            {{ leave.get_status_display }}
                                        </span>
                                    </td>
                                </tr>
                                {% endfor %}
                            </tbody>
                        </table>
                    </div>
                    {% else %}
                    <div class="text-center py-4">
                        <i class="fas fa-calendar-day fa-3x mb-3 text-muted"></i>
                        <p class="mb-0">Vous n'avez pas de congés à venir.</p>
                        <a href="{% url 'leave_request' %}" class="btn btn-primary mt-3">
                            <i class="fas fa-plus-circle me-1"></i> Demander un congé
                        </a>
                    </div>
                    {% endif %}
                </div>
            </div>
        </div>
    </div>
</div>

{% block extra_scripts %}
<script>
    document.addEventListener('DOMContentLoaded', function() {
        // Mettre à jour l'heure en temps réel
        function updateClock() {
            const now = new Date();
            const timeElement = document.getElementById('current-time');
            if (timeElement) {
                timeElement.textContent = now.toLocaleTimeString('fr-FR');
                setTimeout(updateClock, 1000);
            }
        }
        updateClock();
        
        // Animation au survol pour les cartes d'action
        const actionCards = document.querySelectorAll('.action-card');
        actionCards.forEach(card => {
            card.addEventListener('mouseenter', function() {
                this.style.transform = 'translateY(-8px)';
                this.style.boxShadow = '0 15px 30px rgba(0,0,0,0.1)';
            });
            
            card.addEventListener('mouseleave', function() {
                this.style.transform = '';
                this.style.boxShadow = '';
            });
        });
        
        // Initialiser les tooltips Bootstrap
        var tooltipTriggerList = [].slice.call(document.querySelectorAll('[data-bs-toggle="tooltip"]'))
        var tooltipList = tooltipTriggerList.map(function (tooltipTriggerEl) {
            return new bootstrap.Tooltip(tooltipTriggerEl)
        });
        
        // Animation pour les badges avec notification
        const animateBadges = () => {
            document.querySelectorAll('.badge-animated').forEach(badge => {
                badge.classList.add('pulse');
                setTimeout(() => {
                    badge.classList.remove('pulse');
                }, 1000);
            });
        };
        
        // Animer les badges toutes les 5 secondes
        setInterval(animateBadges, 5000);
    });
</script>
{% endblock %}
{% endblock %}